services:
  - type: web
    name: trading-api
    env: python
    plan: free
    buildCommand: pip install -r requirements-api.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port 10000
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: API_KEY
        sync: false
      - key: CORS_ORIGINS
        value: "*"

  - type: cron
    name: trading-daily
    env: python
    buildCommand: pip install -r requirements-jobs.txt
    startCommand: python -m app.pipeline daily
    schedule: "30 6 * * *"
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false

  - type: cron
    name: trading-intraday
    env: python
    buildCommand: pip install -r requirements-jobs.txt
    startCommand: python -m app.pipeline intraday
    schedule: "*/45 8-21 * * *"
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
        
  - type: cron
    name: trading-exec
    env: python
    buildCommand: pip install -r requirements-jobs.txt
    startCommand: python -m app.executor
    schedule: "*/1 13-21 * * 1-5"   # every 1 min during US cash hours M-F (adjust for your timezone)
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: ALPACA_API_KEY
        sync: false
      - key: ALPACA_API_SECRET
        sync: false
      - key: ALPACA_BASE_URL
        value: https://paper-api.alpaca.markets
      - key: MAX_GROSS_LEVERAGE
        value: "1.0"
      - key: MAX_POSITION_PCT
        value: "0.15"
      - key: MIN_PROB
        value: "0.60"
      - key: ORDER_DOLLAR_STEP
        value: "1000"
